## 手把手nodejs指南

-  指南（一）- 3  
-  指南（二）- 204  
-  指南（三）- 273  
- 指南 （四）- 314  
- 指南（五）- 356  
- 指南（六）- 438  
- 指南（七）- 494  
- 指南（八） - 864  
- 指南（九）- 1002  
- 指南（十） - 1100  
- 指南（十一） - 1211  
- 指南（十二）- 1293  
- 指南（十三）- 1373  
- 指南（十四）- 1403  
- 指南（十五）- 1439  
- 指南（十六）- 1470    
- 指南（十七）- 1777    
- 指南（十八）- 1879  
- 指南（十九）- 2039  
- 指南（二十）- 2185  
- 指南（二十一）-2243  
- 指南（二十二）- 2323
- 指南（二十三）- 2450  
- 指南（二十四）- 2610  
- 指南（二十五）- 2698  
- 指南（二十六）- 2732  
- 指南（二十七）- 2798  
- 指南（二十八）- 2920  
- 指南（二十九）- 3013   
- 指南（三十）第一部完結 - 3035  
- 指南（三十一）- 3503  





---------
事前準備:  

.  node -v 16.20.1  
.  npm -v 8.19.4  
.  開一個blog的空白文件夾  

---

要做的事:  
 1. 安裝npm 庫(Library)  
 2. 安裝 library  
 3. 加.gitignore
-----

  ### 安裝npm 庫(Library)  
1. 在終端機  
```
    npm init 
```
2. 不停按enter , 最後 y
```
Press ^C at any time to quit.  
package name: (blog)   
version: (1.0.0)   
description:   
entry point: (index.js)   
test command:   
git repository:   
keywords:   
author:   
license: (ISC)   
About to write to /home/user/桌面/資料/nodejs/Blog/package.json:  

{
  "name": "blog",  
  "version": "1.0.0",  
  "description": "",  
  "main": "index.js",  
  "scripts": {  
    "test": "echo \"Error: no test specified\" && exit 1"  
  },  
  "author": "",  
  "license": "ISC"  
}  


Is this OK? (yes) y  

```
之後在目錄多了package.json  
  ----


## 安裝library  
1. 在終端機  
```
npm install express nodemon 
```

## 加.gitignore
在目錄裹,開一個.gitignore的檔案

1. ./.gitignore  
```
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*
.pnpm-debug.log*

# Diagnostic reports (https://nodejs.org/api/report.html)
report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage
*.lcov

# nyc test coverage
.nyc_output

# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# Snowpack dependency directory (https://snowpack.dev/)
web_modules/

# TypeScript cache
*.tsbuildinfo

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional stylelint cache
.stylelintcache

# Microbundle cache
.rpt2_cache/
.rts2_cache_cjs/
.rts2_cache_es/
.rts2_cache_umd/

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variable files
.env
.env.development.local
.env.test.local
.env.production.local
.env.local

# parcel-bundler cache (https://parceljs.org/)
.cache
.parcel-cache

# Next.js build output
.next
out

# Nuxt.js build / generate output
.nuxt
dist

# Gatsby files
.cache/
# Comment in the public line in if your project uses Gatsby and not Next.js
# https://nextjs.org/blog/next-9-1#public-directory-support
# public

# vuepress build output
.vuepress/dist

# vuepress v2.x temp and cache directory
.temp
.cache

# Docusaurus cache and generated files
.docusaurus

# Serverless directories
.serverless/

# FuseBox cache
.fusebox/

# DynamoDB Local files
.dynamodb/

# TernJS port file
.tern-port

# Stores VSCode versions used for testing VSCode extensions
.vscode-test

# yarn v2
.yarn/cache
.yarn/unplugged
.yarn/build-state.yml
.yarn/install-state.gz
.pnp.*
```

----

 ## 指南（二）- 204

 要做的事:  
 1. 建立 web server  
 2. 運行 web server
 ----

 ### 1.  建立 web server  
 ---

 1. ./package.json
 ```
 {
  "name": "blog",
  "version": "1.0.0",
  "description": "node -v 16.20.1", //“  ”改了 “node -v 16.20.1”
  "main": "server.js",  // “index.js” 改了 "server.js"
  "type": "module", //加了
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node server.js" //加了
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "express": "^4.18.2",
    "nodemon": "^3.0.1"
  }
}

 ```

 2.  在目錄新開名叫server.js 的檔案  
 ```
├── node_modules
├── package.json
├── package-lock.json
├── server.js //新加

 ```
3. ./server.js
```
import express from "express";
const app = express();

app.listen(3000,()=>{
    console.log('3000')
})

```
### 2. 運行 web server  

1. 在終端機  
```
npm start
```
之後在終端機顯示以下
```
> blog@1.0.0 start
> node server.js

3000

```
最主要都是看 3000

---

## 指南（三）- 273  

要做的事: 

- 建立API && 測試API  

---

### 建立API && 測試API  

1. ./ server.js  
```
import express from "express";
const app = express();


app.get('/',(req,res)=>{  //增加
    res.send('is work')   //增加
})   //增加


app.listen(3000,()=>{
    console.log('3000')
})

```
2. 之後開始測驗API  
    用vscode裹的Thunder   
    在終端機  
    ```
    npm start
    ```

    在Thunder 
    <img src="./node-blog/API 測試 .png">  

    看到 is work 你就是成功

    ---

    ## 指南(四) - 314  

    要做的事：
    - 建立多個API 

    ---
    1. ./ server.js  

```
import express from "express";
const app = express();


app.get('/',(req,res)=>{  
    res.send('home') // is work 改了 home  
})  

app.get('/about',(req,res)=>{  //增加  
    res.send('about')  //增加  
})//增加  

app.get('/register',(req,res)=>{ //增加  
    res.send('register') //增加  
}) //增加  

app.get('/login', (req,res)=>{  //增加   
    res.send('login') //增加  
})  //增加  

app.get('/blog',(req,res)=>{  //增加  
    res.send('blog')  //增加  
})  //增加  


app.listen(3000,()=>{  
    console.log('3000')  
})  

```
---

## 指南（五）- 356  

要做的事：  
- 安裝View Engine  
- 設定View Engine  

---
###    安裝View Engine  

1. 在終端機  
```
npm install ejs
```
之後在 package.json 裹  
```
{
  "name": "blog",
  "version": "1.0.0",
  "description": "node -v 16.20.1",
  "main": "server.js",
  "type": "module",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node server.js"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "ejs": "^3.1.9",  //會自動增加  
    "express": "^4.18.2",
    "nodemon": "^3.0.1"
  }
}
```
---


### 設定View Engine   

1.  ./server.js

```
import express from "express";
const app = express();

// set view engine
app.set('view engine' , 'ejs');  //增加


// router
app.get('/',(req,res)=>{
    res.send('home')
})

app.get('/about',(req,res)=>{
    res.send('about')
})

app.get('/register',(req,res)=>{
    res.send('register')
})

app.get('/login', (req,res)=>{
    res.send('login')
})

app.get('/blog',(req,res)=>{
    res.send('blog')
})


app.listen(3000,()=>{
    console.log('3000')
})


```

---

## 指南（六）- 438  

要做的事: 

- 建立views && templates page

---

### 建立views && templates page 

1. 在目錄裹開一個views的文件夾
```
├── node_modules
├── package.json
├── package-lock.json
├── server.js
├── views  //加了
```
2. 在views裹分別創建about.ejs , blog.ejs , home.ejs , login.ejs , register.ejs
```
├── node_modules
├── package.json
├── package-lock.json
├── server.js
├── views
│   ├── about.ejs
│   ├── blog.ejs
│   ├── home.ejs
│   ├── login.ejs
│   └── register.ejs

```  
3. views/about.ejs  
```
about
```  
4. views/blog.ejs  
```
blog
```
5. views/home.ejs
```
home
```  
6. views/login.ejs
```
login
```
7. views/register.ejs
```
register
```

---

## 指南（七）- 494  

public裹的assets在 github 到拿資源 

---

要做的事:  
- 修改html 內容  

---

### 修改html 內容  

1. views/about.ejs  
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>About us - Brand</title>
    <link rel="stylesheet" href="../public/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="../public/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
    <link rel="stylesheet" href="../public/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
        <div class="container"><a class="navbar-brand" href="/index.html">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/index.html" style="margin-left: 11px;margin-right: 14px;">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about.html">About us</a></li>
                    <li class="nav-item"></li>
                    <li class="nav-item"><a class="nav-link" href="/post.html">Blog Post</a></li>
                    <li class="nav-item"><a class="nav-link" href="/register.html">register</a></li>
                    <li class="nav-item"><a class="nav-link" href="/login.html">login</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead" style="background-image:url('/assets/img/about-bg.jpg?h=ca94606afe09dc1190c07f9b89d907e7');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="site-heading">
                        <h1>About Me</h1><span class="subheading">This is what I do</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-lg-8 mx-auto">
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Saepe nostrum ullam eveniet pariatur voluptates odit, fuga atque ea nobis sit soluta odio, adipisci quas excepturi maxime quae totam ducimus consectetur?</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius praesentium recusandae illo eaque architecto error, repellendus iusto reprehenderit, doloribus, minus sunt. Numquam at quae voluptatum in officia voluptas voluptatibus, minus!</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut consequuntur magnam, excepturi aliquid ex itaque esse est vero natus quae optio aperiam soluta voluptatibus corporis atque iste neque sit tempora!</p>
            </div>
        </div>
    </div>
    <hr>
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></li>
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></li>
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></li>
                    </ul>
                    <p class="text-muted copyright">Copyright&nbsp;©&nbsp;Brand 2023</p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../public/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script>
</body>

</html>
```
2. views/blog.ejs  
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Blog Post - Brand</title>
    <link rel="stylesheet" href="../public/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="../public/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
    <link rel="stylesheet" href="../public/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
        <div class="container"><a class="navbar-brand" href="/index.html">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/index.html" style="margin-left: 11px;margin-right: 14px;">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about.html">About us</a></li>
                    <li class="nav-item"></li>
                    <li class="nav-item"><a class="nav-link" href="/post.html">Blog Post</a></li>
                    <li class="nav-item"><a class="nav-link" href="/register.html">register</a></li>
                    <li class="nav-item"><a class="nav-link" href="/login.html">login</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead" style="background-image:url('/assets/img/post-bg.jpg?h=9b3eae5bf913af77d61c0390cba13bf5');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="post-heading">
                        <h1>Man must explore, and this is exploration at its greatest</h1>
                        <h2 class="subheading">Problems look mighty small from 150 miles up</h2><span class="meta">Posted by&nbsp;<a href="#">Start Bootstrap</a>&nbsp;on August 24, 2018</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <article>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto">
                    <p>Never in all their history have men been able truly to conceive of the world as one: a single sphere, a globe, having the qualities of a globe, a round earth in which all the directions eventually meet, in which there is no center because every point, or none, is center — an equal earth which all men occupy as equals. The airman's earth, if free men make it, will be truly round: a globe in practice, not in theory.</p>
                    <p>Science cuts two ways, of course; its products can be used for both good and evil. But there's no turning back from science. The early warnings about technological dangers also come from science.</p>
                    <p>What was most significant about the lunar voyage was not that man set foot on the Moon but that they set eye on the earth.</p>
                    <p>A Chinese tale tells of some men sent to harm a young girl who, upon seeing her beauty, become her protectors rather than her violators. That's how I felt seeing the Earth for the first time. I could not help but love and cherish her.</p>
                    <p>For those who have seen the Earth from space, and for the hundreds and perhaps thousands more who will, the experience most certainly changes your perspective. The things that we share in our world are far more valuable than those which divide us.</p>
                    <h2 class="section-heading">Heading</h2>
                    <p>There can be no thought of finishing for ‘aiming for the stars.’ Both figuratively and literally, it is a task to occupy the generations. And no matter how much progress one makes, there is always the thrill of just beginning.</p>
                    <p>There can be no thought of finishing for ‘aiming for the stars.’ Both figuratively and literally, it is a task to occupy the generations. And no matter how much progress one makes, there is always the thrill of just beginning.</p>
                    <figure>
                        <blockquote class="blockquote">
                            <p class="mb-0">The dreams of yesterday are the hopes of today and the reality of tomorrow. Science has not yet mastered prophecy. We predict too much for the next year and yet far too little for the next ten.</p>
                        </blockquote>
                    </figure>
                    <p>Spaceflights cannot be stopped. This is not the work of any one man or even a group of men. It is a historical process which mankind is carrying out in accordance with the natural laws of human development.</p>
                    <h2 class="section-heading">Reaching for the Stars</h2>
                    <p>As we got further and further away, it [the Earth] diminished in size. Finally it shrank to the size of a marble, the most beautiful you can imagine. That beautiful, warm, living object looked so fragile, so delicate, that if you touched it with a finger it would crumble and fall apart. Seeing this has to change a man.</p><a href="#"><img class="img-fluid" src="/assets/img/post-sample-image.jpg?h=a3cddd21d9e594fe69a0fc790b5ca3d0"></a><span class="text-muted caption">To go places and do things that have never been done before – that’s what living is all about.</span>
                    <p>Space, the final frontier. These are the voyages of the Starship Enterprise. Its five-year mission: to explore strange new worlds, to seek out new life and new civilizations, to boldly go where no man has gone before.</p>
                    <p>As I stand out here in the wonders of the unknown at Hadley, I sort of realize there’s a fundamental truth to our nature, Man must explore, and this is exploration at its greatest.</p>
                    <p><span>Placeholder text by&nbsp;</span><a href="http://spaceipsum.com">Space Ipsum</a><span>&nbsp;Photographs by&nbsp;</span><a href="https://www.flickr.com/photos/nasacommons/">NASA on The Commons</a>.</p>
                </div>
            </div>
        </div>
    </article>
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></li>
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></li>
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></li>
                    </ul>
                    <p class="text-muted copyright">Copyright&nbsp;©&nbsp;Brand 2023</p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../public/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script>
</body>

</html>
```
3. views/home.ejs  
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - Brand</title>
    <link rel="stylesheet" href="../public/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="../public/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
    <link rel="stylesheet" href="../public/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
        <div class="container"><a class="navbar-brand" href="/index.html">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/index.html" style="margin-left: 11px;margin-right: 14px;">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about.html">About us</a></li>
                    <li class="nav-item"></li>
                    <li class="nav-item"><a class="nav-link" href="/post.html">Blog Post</a></li>
                    <li class="nav-item"><a class="nav-link" href="/register.html">register</a></li>
                    <li class="nav-item"><a class="nav-link" href="/login.html">login</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead" style="background-image:url('/assets/img/home-bg.jpg?h=ed6236475a1226b743bf65e6f1bebb34');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="site-heading">
                        <h1>Clean Blog</h1><span class="subheading">A Blog Theme by Start Bootstrap</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></li>
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></li>
                        <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></li>
                    </ul>
                    <p class="text-muted copyright">Copyright&nbsp;©&nbsp;Brand 2023</p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../public/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script>
</body>

</html>
```
4. views/login.ejs  
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Login - Brand</title>
    <link rel="stylesheet" href="../public/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="../public/assets/css/Lora.css?h=a4fa0940ea012724c5b96afc8bbcdf11">
    <link rel="stylesheet" href="../public/assets/css/Open%20Sans.css?h=f387147e95af341639f58a013c3cb46a">
    <link rel="stylesheet" href="../public/assets/css/Login-Form-Basic-icons.css?h=befd8a398792e305b7ffd4a176b5b585">
</head>

<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/index.html">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/index.html" style="margin-left: 11px;margin-right: 14px;">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/about.html">About us</a></li>
                <li class="nav-item"></li>
                <li class="nav-item"><a class="nav-link" href="/post.html">Blog Post</a></li>
                <li class="nav-item"><a class="nav-link" href="/register.html">register</a></li>
                <li class="nav-item"><a class="nav-link" href="/login.html">login</a></li>
            </ul>
        </div>
    </div>
</nav>


<body style="background: rgb(96,96,96);color: rgb(255,255,255);">
    <section class="position-relative py-4 py-xl-5">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md-8 col-xl-6 text-center mx-auto">
                    <h2>Log in</h2>
                    <p class="w-lg-50">Curae hendrerit donec commodo hendrerit egestas tempus, turpis facilisis nostra nunc. Vestibulum dui eget ultrices.</p>
                </div>
            </div>
            <div class="row d-flex justify-content-center">
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-5">
                        <div class="card-body d-flex flex-column align-items-center" style="background: #5c5c5c;color: rgb(255, 255, 255);--bs-body-color: #ffffff;">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary bs-icon my-4"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-person">
                                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"></path>
                                </svg></div>
                            <form class="text-center" method="post">
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">Login</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../public/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script>
</body>

</html>
```
5. views/register.ejs  
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Register - Brand</title>
    <link rel="stylesheet" href="../public/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="../public/assets/css/Lora.css?h=a4fa0940ea012724c5b96afc8bbcdf11">
    <link rel="stylesheet" href="../public/assets/css/Open%20Sans.css?h=f387147e95af341639f58a013c3cb46a">
    <link rel="stylesheet" href="../public/assets/css/Login-Form-Basic-icons.css?h=befd8a398792e305b7ffd4a176b5b585">
</head>

<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/index.html">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/index.html" style="margin-left: 11px;margin-right: 14px;">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/about.html">About us</a></li>
                <li class="nav-item"></li>
                <li class="nav-item"><a class="nav-link" href="/post.html">Blog Post</a></li>
                <li class="nav-item"><a class="nav-link" href="/register.html">register</a></li>
                <li class="nav-item"><a class="nav-link" href="/login.html">login</a></li>
            </ul>
        </div>
    </div>
</nav>


<body style="background: rgb(96,96,96);color: rgb(255,255,255);">
    <section class="position-relative py-4 py-xl-5">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md-8 col-xl-6 text-center mx-auto">
                    <h2>Register</h2>
                    <p class="w-lg-50">Curae hendrerit donec commodo hendrerit egestas tempus, turpis facilisis nostra nunc. Vestibulum dui eget ultrices.</p>
                </div>
            </div>
            <div class="row d-flex justify-content-center">
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-5">
                        <div class="card-body d-flex flex-column align-items-center" style="background: #5c5c5c;color: rgb(255, 255, 255);--bs-body-color: #ffffff;">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary bs-icon my-4"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-person">
                                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"></path>
                                </svg></div>
                            <form class="text-center" method="post">
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">register</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../public/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script>
</body>

</html>
```

---

## 指南（八） - 864  
要做的事：
- 把ejs render 出來
---

### 把ejs render 出來  

1.  ./server.js

```
import express from "express";
import path from "path"; //增加
const app = express();

// set view engine
app.set('view engine' , 'ejs');
app.use(express.static(path.resolve('./public'))) //增加



// router
app.get('/',(req,res)=>{
    res.render('home')  //改了
})

app.get('/about',(req,res)=>{
    res.render('about')  //改了
})

app.get('/register',(req,res)=>{
    res.render('register')  //改了
})

app.get('/login', (req,res)=>{
    res.render('login')  //改了
})

app.get('/blog',(req,res)=>{
    res.render('blog')  //改了
})


app.listen(3000,()=>{
    console.log('3000')
})


```

2. views/abouts.ejs  
```
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>About us - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf"> //不要../public
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56"> //不要../public
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9"> //不要../public
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

...

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script> //不要../public
```  
3. views/blogs.ejs  
```
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>About us - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf"> //不要../public
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56"> //不要../public
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9"> //不要../public
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

...

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script> //不要../public

```  
4. views/home.ejs  
```
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>About us - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf"> //不要../public
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56"> //不要../public
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9"> //不要../public
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

...

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script> //不要../public
```  
5. views/login.ejs  
```
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>About us - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf"> //不要../public
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56"> //不要../public
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9"> //不要../public
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

...

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script> //不要../public
```  
6. views/register.ejs  
```
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>About us - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf"> //不要../public
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56"> //不要../public
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9"> //不要../public
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

...

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script> //不要../public
```

---   
## 指南（九）- 1002  

要做的事:  
- del html bug  

---

1. views/about.ejs  
```

...

<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button> //改了 href 
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/" style="margin-left: 11px;margin-right: 14px;">Home</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/about">About us</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/blog">Blog Post</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/register">register</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/login">login</a></li>  //改了 href
            </ul>
        </div>
    </div>
</nav>


...

```
2. views/blog.ejs
```
<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button> //改了 href 
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/" style="margin-left: 11px;margin-right: 14px;">Home</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/about">About us</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/blog">Blog Post</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/register">register</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/login">login</a></li>  //改了 href
            </ul>
        </div>
    </div>
</nav>
```
3. views/home.ejs
```
<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button> //改了 href 
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/" style="margin-left: 11px;margin-right: 14px;">Home</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/about">About us</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/blog">Blog Post</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/register">register</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/login">login</a></li>  //改了 href
            </ul>
        </div>
    </div>
</nav>
```
4. views/login.ejs
```
<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button> //改了 href 
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/" style="margin-left: 11px;margin-right: 14px;">Home</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/about">About us</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/blog">Blog Post</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/register">register</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/login">login</a></li>  //改了 href
            </ul>
        </div>
    </div>
</nav>
```
5. views/register.ejs
```
<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button> //改了 href 
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/" style="margin-left: 11px;margin-right: 14px;">Home</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/about">About us</a></li> //改了 href
                <li class="nav-item"><a class="nav-link" href="/blog">Blog Post</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/register">register</a></li>  //改了 href
                <li class="nav-item"><a class="nav-link" href="/login">login</a></li>  //改了 href
            </ul>
        </div>
    </div>
</nav>
```

---

## 指南（十） - 1100

要做的事：
- 安裝 mongoose  及 nodemon
- 建立 model  

---

### 安裝 mongoose  

1. 在終端機  
```
 npm install mongoose@6.11.1 nodemon
```
2. ./ package.json 
```
{
  "name": "blog",
  "version": "1.0.0",
  "description": "node -v 16.20.1",
  "main": "server.js",
  "type": "module",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node server.js",
    "dev": "nodemon server.js"  //  加了 
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "ejs": "^3.1.9",
    "express": "^4.18.2",
    "mongoose": "^6.11.1",
    "nodemon": "^3.0.1"
  }
}

```
---

### 建立 model  

1. 在目錄新創名叫models的文件夾，在models內，創建Blog.js
```
├── models
│   └── Blog.js
├── node_modules
├── public
├── server.js
├── views
├── package-lock.json
├── package.json

```
2. models/Blog.js
```
import mongoose from "mongoose";

const BlogSchame = new mongoose.Schema({

    title:{
        type: String,
    },
    description:{
        type: String,
    },
},{timestamps:true})

const Blog = mongoose.models.Blog || mongoose.model("Blogs", BlogSchame);

export default Blog
```

3.  ./server.js
```
import express from "express";
import path from "path";
import mongoose from "mongoose"; //加了


const app = express();

// set view engine
app.set('view engine' , 'ejs');
app.use(express.static(path.resolve('./public')))


// connect mongoose   //加了
const connect = async () =>{  //加了
    try {   //加了
        await mongoose.connect('mongodb://localhost/blog')  //加了
        console.log(' db is connect ')  //加了
    } catch (error) {   //加了
        console.log (error)  //加了
    }   //加了

}   //加了

...

app.listen(3000,()=>{
    connect();  //加了
    console.log('3000')
})



```
---

## 指南（十一） - 1211  

要做的事:
- 為blog增加 post api 

---

### 為blog增加 post api 

1. server.js  
```
import express from "express";
import path from "path";
import mongoose from "mongoose";


const app = express();

app.use(express.json()); //加了


// set view engine
app.set('view engine' , 'ejs');
app.use(express.static(path.resolve('./public')))


// connect mongoose
const connect = async () =>{
    try {
        await mongoose.connect('mongodb://localhost/blog')
        console.log(' db is connect ')
    } catch (error) {
        console.log (error)
    }

}



// router
app.get('/',(req,res)=>{
    res.render('home')
})

app.get('/about',(req,res)=>{
    res.render('about')
})

app.get('/register',(req,res)=>{
    res.render('register')
})

app.get('/login', (req,res)=>{
    res.render('login')
})

app.get('/blog',(req,res)=>{
    res.render('blog')
})

app.post('/BlogPostAdd',(req,res)=>{   //加了
    const {title, description }= req.body;  //加了
    

    console.log('title : ',title , " description : ", description)   //加了

    res.status(200).json({title ,  description})   //加了
})  //加了


app.listen(3000,()=>{
    connect();
    console.log('3000')
})




```
---

## 指南（十二）- 1293  

要做的事：  
- 把data 傳入 DB  


### 把data 傳入 DB  

1. server.js  
```

import express from "express";
import path from "path";
import mongoose from "mongoose";
import Blog from './models/Blog.js'  //加了

const app = express();

app.use(express.json());


// set view engine
app.set('view engine' , 'ejs');
app.use(express.static(path.resolve('./public')))


// connect mongoose
const connect = async () =>{
    try {
        await mongoose.connect('mongodb://localhost/blog')
        console.log(' db is connect ')
    } catch (error) {
        console.log (error)
    }

}



...

app.post('/BlogPostAdd', async (req,res)=>{  //改了
    const {title, description }= req.body;

    console.log('title : ',title , " description : ", description)

    const newBlog = new Blog ({   //加了

        title : title,     //加了
        description : description    //加了
    })   //加了
    
    console.log(newBlog)   //加了

    try {  //加了
        const saveBlog = await newBlog.save()   //加了

       res.status(200).json(saveBlog)  //加了
    } catch (error) {     //加了
        res.status(404).json(error)   //加了
    }


   
})


app.listen(3000,()=>{
    connect();
    console.log('3000')
})


```
會出現以下為成功：
<img src="../Blog/blogimg/data in db.png">

---
## 指南（十三）- 1373  

要做的事：
- 用Get api 拿 db data  

### 用Get api 拿 db data  

1. ./server.js  
```
...

app.get('/Blog',async(req,res)=>{
    try {
    const getBlogs = await Blog.find();
    res.status(200).json(getBlogs) 
    } catch (error) {
    res.status(404).json(error)
    }

})

...

```
會出現以下為成功：
<img src="../Blog/blogimg/get DB .png">
---

## 指南（十四）- 1403  

要做的事：  
- 用put api 修改 db  data  


### 用put api 修改 db  data  
1. ./server.js  
```

...

app.put('/EditBlog/:id', async (req,res)=>{
    try {
    const updatedblog = await Blog.findByIdAndUpdate(req.params.id,{
        $set:req.body,
    },{new:true})

    res.status(200).json(updatedblog)

    } catch (error) {
        res.status(404).json(error)
    }

})

...


```
以下為成功畫面：
<img src="../Blog/blogimg/update db data .png">

---

## 指南（十五）- 1439  

要做的事：  
- 用del api 刪除 db data  

###  用del api 刪除 db data

1. ./server.js
```
...

app.delete('/DelBlog/:id',async(req,res)=>{
    try {
        await Blog.findByIdAndDelete(req.params.id)
        res.status(200).json('del !!')
    } catch (error) {
        res.status(404).json(error)
    }
})
...

```
成功會出以下：
<img src='../Blog/blogimg/del data.png'>  
之後再拿Get api:
<img src='../Blog//blogimg/del after db.png'>  
是空白的，因為這裹只做一個data  

---

## 指南（十六）- 1470

要做的事：
- 分拆html

### 分拆html
在views裹創建partials的文件夾，在partials裹創建foot.ejs 和 nav.ejs  

```
├── views
│   ├── about.ejs
│   ├── blog.ejs
│   ├── home.ejs
│   ├── login.ejs
│   ├── partials
│   │   ├── foot.ejs
│   │   └── nav.ejs
│   └── register.ejs

```


1. views/partials/foot.ejs
```
<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-lg-8 mx-auto">
                <ul class="list-inline text-center">
                    <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></li>
                    <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></li>
                    <li class="list-inline-item"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></li>
                </ul>
                <p class="text-muted copyright">Copyright&nbsp;©&nbsp;Brand 2023</p>
            </div>
        </div>
    </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/js/clean-blog.js?h=44b1c6e85af97fda0fedbb834b3ff3f8"></script>

```

2. views/partials/nav.ejs
```
<nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
    <div class="container"><a class="navbar-brand" href="/">Brand</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/" style="margin-left: 11px;margin-right: 14px;">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/about">About us</a></li>
                <li class="nav-item"><a class="nav-link" href="/blog">Blog Post</a></li>
                <li class="nav-item"><a class="nav-link" href="/register">register</a></li>
                <li class="nav-item"><a class="nav-link" href="/login">login</a></li>
            </ul>
        </div>
    </div>
</nav>
```

3. views/about.ejs
```<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>About us - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <% -include('partials/nav.ejs') %>  //加了
    <header class="masthead" style="background-image:url('/assets/img/about-bg.jpg?h=ca94606afe09dc1190c07f9b89d907e7');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="site-heading">
                        <h1>About Me</h1><span class="subheading">This is what I do</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-lg-8 mx-auto">
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Saepe nostrum ullam eveniet pariatur voluptates odit, fuga atque ea nobis sit soluta odio, adipisci quas excepturi maxime quae totam ducimus consectetur?</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius praesentium recusandae illo eaque architecto error, repellendus iusto reprehenderit, doloribus, minus sunt. Numquam at quae voluptatum in officia voluptas voluptatibus, minus!</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut consequuntur magnam, excepturi aliquid ex itaque esse est vero natus quae optio aperiam soluta voluptatibus corporis atque iste neque sit tempora!</p>
            </div>
        </div>
    </div>
    <hr>
<% -include('partials/foot.ejs') %>  //加了
</body>

</html>

```

4. views/blog.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Blog Post - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <% -include('partials/nav.ejs') %>  //加了
    <header class="masthead" style="background-image:url('/assets/img/post-bg.jpg?h=9b3eae5bf913af77d61c0390cba13bf5');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="post-heading">
                        <h1>Man must explore, and this is exploration at its greatest</h1>
                        <h2 class="subheading">Problems look mighty small from 150 miles up</h2><span class="meta">Posted by&nbsp;<a href="#">Start Bootstrap</a>&nbsp;on August 24, 2018</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <article>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto">
                    <p>Never in all their history have men been able truly to conceive of the world as one: a single sphere, a globe, having the qualities of a globe, a round earth in which all the directions eventually meet, in which there is no center because every point, or none, is center — an equal earth which all men occupy as equals. The airman's earth, if free men make it, will be truly round: a globe in practice, not in theory.</p>
                    <p>Science cuts two ways, of course; its products can be used for both good and evil. But there's no turning back from science. The early warnings about technological dangers also come from science.</p>
                    <p>What was most significant about the lunar voyage was not that man set foot on the Moon but that they set eye on the earth.</p>
                    <p>A Chinese tale tells of some men sent to harm a young girl who, upon seeing her beauty, become her protectors rather than her violators. That's how I felt seeing the Earth for the first time. I could not help but love and cherish her.</p>
                    <p>For those who have seen the Earth from space, and for the hundreds and perhaps thousands more who will, the experience most certainly changes your perspective. The things that we share in our world are far more valuable than those which divide us.</p>
                    <h2 class="section-heading">Heading</h2>
                    <p>There can be no thought of finishing for ‘aiming for the stars.’ Both figuratively and literally, it is a task to occupy the generations. And no matter how much progress one makes, there is always the thrill of just beginning.</p>
                    <p>There can be no thought of finishing for ‘aiming for the stars.’ Both figuratively and literally, it is a task to occupy the generations. And no matter how much progress one makes, there is always the thrill of just beginning.</p>
                    <figure>
                        <blockquote class="blockquote">
                            <p class="mb-0">The dreams of yesterday are the hopes of today and the reality of tomorrow. Science has not yet mastered prophecy. We predict too much for the next year and yet far too little for the next ten.</p>
                        </blockquote>
                    </figure>
                    <p>Spaceflights cannot be stopped. This is not the work of any one man or even a group of men. It is a historical process which mankind is carrying out in accordance with the natural laws of human development.</p>
                    <h2 class="section-heading">Reaching for the Stars</h2>
                    <p>As we got further and further away, it [the Earth] diminished in size. Finally it shrank to the size of a marble, the most beautiful you can imagine. That beautiful, warm, living object looked so fragile, so delicate, that if you touched it with a finger it would crumble and fall apart. Seeing this has to change a man.</p><a href="#"><img class="img-fluid" src="/assets/img/post-sample-image.jpg?h=a3cddd21d9e594fe69a0fc790b5ca3d0"></a><span class="text-muted caption">To go places and do things that have never been done before – that’s what living is all about.</span>
                    <p>Space, the final frontier. These are the voyages of the Starship Enterprise. Its five-year mission: to explore strange new worlds, to seek out new life and new civilizations, to boldly go where no man has gone before.</p>
                    <p>As I stand out here in the wonders of the unknown at Hadley, I sort of realize there’s a fundamental truth to our nature, Man must explore, and this is exploration at its greatest.</p>
                    <p><span>Placeholder text by&nbsp;</span><a href="http://spaceipsum.com">Space Ipsum</a><span>&nbsp;Photographs by&nbsp;</span><a href="https://www.flickr.com/photos/nasacommons/">NASA on The Commons</a>.</p>
                </div>
            </div>
        </div>
    </article>
    <% -include('partials/foot.ejs') %>  //加了
</body>

</html>
```

5. views/home.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <% -include('partials/nav.ejs') %>  //加了
    <header class="masthead" style="background-image:url('/assets/img/home-bg.jpg?h=ed6236475a1226b743bf65e6f1bebb34');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="site-heading">
                        <h1>Clean Blog</h1><span class="subheading">A Blog Theme by Start Bootstrap</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <% -include('partials/foot.ejs') %>  //加了
</body>

</html>
```

6. views/login.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Login - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="/assets/css/Lora.css?h=a4fa0940ea012724c5b96afc8bbcdf11">
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=f387147e95af341639f58a013c3cb46a">
    <link rel="stylesheet" href="/assets/css/Login-Form-Basic-icons.css?h=befd8a398792e305b7ffd4a176b5b585">
</head>

<% -include('partials/nav.ejs') %>  //加了


<body style="background: rgb(96,96,96);color: rgb(255,255,255);">
    <section class="position-relative py-4 py-xl-5">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md-8 col-xl-6 text-center mx-auto">
                    <h2>Log in</h2>
                    <p class="w-lg-50">Curae hendrerit donec commodo hendrerit egestas tempus, turpis facilisis nostra nunc. Vestibulum dui eget ultrices.</p>
                </div>
            </div>
            <div class="row d-flex justify-content-center">
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-5">
                        <div class="card-body d-flex flex-column align-items-center" style="background: #5c5c5c;color: rgb(255, 255, 255);--bs-body-color: #ffffff;">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary bs-icon my-4"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-person">
                                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"></path>
                                </svg></div>
                            <form class="text-center" method="post">
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">Login</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <% -include('partials/foot.ejs') %>  //加了
</body>

</html>
```

7. views/register.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Register - Brand</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
    <link rel="stylesheet" href="/assets/css/Lora.css?h=a4fa0940ea012724c5b96afc8bbcdf11">
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=f387147e95af341639f58a013c3cb46a">
    <link rel="stylesheet" href="/assets/css/Login-Form-Basic-icons.css?h=befd8a398792e305b7ffd4a176b5b585">
</head>

<% -include('partials/nav.ejs') %>  //加了


<body style="background: rgb(96,96,96);color: rgb(255,255,255);">
    <section class="position-relative py-4 py-xl-5">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md-8 col-xl-6 text-center mx-auto">
                    <h2>Register</h2>
                    <p class="w-lg-50">Curae hendrerit donec commodo hendrerit egestas tempus, turpis facilisis nostra nunc. Vestibulum dui eget ultrices.</p>
                </div>
            </div>
            <div class="row d-flex justify-content-center">
                <div class="col-md-6 col-xl-4">
                    <div class="card mb-5">
                        <div class="card-body d-flex flex-column align-items-center" style="background: #5c5c5c;color: rgb(255, 255, 255);--bs-body-color: #ffffff;">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary bs-icon my-4"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-person">
                                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"></path>
                                </svg></div>
                            <form class="text-center" method="post">
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">register</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <% -include('partials/foot.ejs') %>  //加了
</body>

</html>
```

---
## 指南（十七）- 1777  

(form 的 css在 public/assets/bootstrap/css/bootstrap.main.form.css)
請到github自行下載

要做的事:

- 建立form  
- 建立add blog page  和  edit blog page   

### 建立form 
在partials裹新建form.ejs

1. views/partials/form.ejs
```
<div class="mb-3"><input class="form-control" type="text" id="name-2" name="title" placeholder="Title"></div>
<div class="mb-3"></div>
<div class="mb-3"><textarea class="form-control" id="message-2" name="description" rows="6" placeholder="Description"></textarea></div>
<div><button class="btn btn-primary d-block w-100" type="submit">Send </button></div>
```

### 建立add form  和  edit form 

在views 裹新創addblog.ejs 和 editblog.ejs 

1.views/addblog.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Add Blog</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.form.css?h=025df1ec88740cad5ff14bb3380da6dd">
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
</head>

<body>
    <%- include('partials/nav.ejs')  %>
    <section class="position-relative py-4 py-xl-5">
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post">
                                <%- include('partials/form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>
</body>

</html>
```

2. views/editblog.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Edit Blog</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.form.css?h=025df1ec88740cad5ff14bb3380da6dd">
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
</head>

<body>
    <%- include('partials/nav.ejs')  %>
    <section class="position-relative py-4 py-xl-5">
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post">
                                <%- include('partials/form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>
</body>

</html>

```

---

## 指南（十八）- 1879

要做的事：
- addblog api 和 editblog api
- 修改 html bug 


###  addblog api 和 editblog api

1. server.js

```
....

app.get('/AddBlog',(req,res)=>{
    res.render('addblog')
})

app.get('/EditBlog',(req,res)=>{
    res.render('editblog')
})



....
```

### 修改 html bug 
全部 的
```
<% - include('partials/nav.ejs') %>
```
改掉為 
```
<%- include('partials/nav.ejs') %>
```

這是ejs 格式錯
1.  views/about.ejs
```
<%- include('partials/nav.ejs') %>
...

<%- include('partials/foot.ejs') %>
```
2.  views/blog.ejs
```
<%- include('partials/nav.ejs') %>
...

<%- include('partials/foot.ejs') %>
```
3.  views/home.ejs
```
<%- include('partials/nav.ejs') %>
...

<%- include('partials/foot.ejs') %>
```
4.  views/login.ejs
```
<%- include('partials/nav.ejs') %>
...

<%- include('partials/foot.ejs') %>
```
5.  views/register.ejs
```
<%- include('partials/nav.ejs') %>
...

<%- include('partials/foot.ejs') %>
```

6.  views/addblog.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Add Blog</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.form.css?h=025df1ec88740cad5ff14bb3380da6dd">

    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf"> 

    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">  //增加
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">  //增加
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">  //增加
</head>

<body>
    <section class="position-relative py-4 py-xl-5 bg-black "> //改了 多了bg-black 及位置轉了
    <%- include('partials/nav.ejs') %>   //位置轉了
    </section>  
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post">
                                <%- include('partials/form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>
</body>

</html>
```
7.  views/editblog.ejs
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Edit Blog</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.form.css?h=025df1ec88740cad5ff14bb3380da6dd">

    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">

    <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
    <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <section class="position-relative py-4 py-xl-5 bg-black ">
    <%- include('partials/nav.ejs') %>
    </section>
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post">
                                <%- include('partials/form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>
</body>

</html>
```

---

## 指南（十九）- 2039
要做的事：
- 建立addpost頁面 連結 
- 在addpost 頁面輸入資料

----
###  建立addpost頁面

1. ./ server.js  
```

....
app.get('/Blog',async(req,res)=>{
    // try {
    // const getBlogs = await Blog.find();
    // res.status(200).json(getBlogs) 
    // } catch (error) {
    // res.status(404).json(error)
    // }

    res.render('blog')  //增加 為了進入頁面

})

....
```

2. views/blog.ejs
```
....
<body>
    <%- include('partials/nav.ejs') %>
    <header class="masthead" style="background-image:url('/assets/img/post-bg.jpg?h=9b3eae5bf913af77d61c0390cba13bf5');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="post-heading">
                        <h1>Man must explore, and this is exploration at its greatest</h1>
                        <h2 class="subheading">Problems look mighty small from 150 miles up</h2><span class="meta">Posted by&nbsp;<a href="#">Start Bootstrap</a>&nbsp;on August 24, 2018</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
// header 以上沒有改變
//修改了以下

    <div class="container">
        <h1 class="mb-4">Blog </h1>
        <a href="/addblog" class="btn btn-success">New Blog</a>
    
        
          <div class="card mt-4">
            <div class="card-body">
              <h4 class="card-title">title</h4>
             
              <div class="card-text mb-2">description</div>
              <a href="" class="btn btn-primary">Read More</a>
              <a href="" class="btn btn-info">Edit</a>
              <form action="" method="POST" class="d-inline">
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
      </div>
    <%- include('partials/foot.ejs') %>
</body>

</html>

```

---

###  在addpost 頁面輸入資料

1. addblog.ejs
```
...

    <%- include('partials/nav.ejs') %>
    </section>
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post" action="/BlogPostAdd"> // 增加了action
                                <%- include('partials/form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>

...

```

2. ./server.js  

```
...

app.use(express.json());
app.use(express.urlencoded({ extended: false }))  //增加

//如果不加  title, description 就會出 undefined

....


app.post('/BlogPostAdd', async (req,res)=>{
    const {title, description }= req.body;

    console.log('title : ',title , " description : ", description)

    const newBlog = new Blog ({

        title : title,
        description : description
    })
    
    console.log(newBlog)

     try {
        const saveBlog = await newBlog.save()

   // res.status(200).json(saveBlog)  
    res.redirect('/Blog') //增加
    } catch (error) {
        res.status(404).json(error)
    }
   
})
....

```
----

## 指南（二十）- 2185  
要做的事:
- 在blog 裹顥示post 

###  在blog 裹顥示post 
1. .server.js
```
app.get('/Blog',async(req,res)=>{
    // try {
    // const getBlogs = await Blog.find();
    // res.status(200).json(getBlogs) 
    // } catch (error) {
    // res.status(404).json(error)
    // }
    const getposts = await Blog.find(); //增加

    res.render('blog' , {Posts: getposts})  //加了

})

```

2. views/blog.ejs

```
...


    <div class="container">
        <h1 class="mb-4">Blog </h1>
        <a href="/addblog" class="btn btn-success">New Blog</a>
    
        <% Posts.forEach(post => { %>  //加了
          <div class="card mt-4">
            <div class="card-body">
              <h4 class="card-title"><%= post.title %></h4>  //改了
             
              <div class="card-text mb-2"><%=  post.description %></div> //改了
              <a href="" class="btn btn-primary">Read More</a>
              <a href="" class="btn btn-info">Edit</a>
              <form action="" method="POST" class="d-inline">
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
          <% }) %>  //加了
      </div>
    <%- include('partials/foot.ejs') %>
</body>

</html>


```

----

## 指南（二+一）-2243  
要做的事:
- 令刪除接鍵運行

###  令刪除接鍵運行  

在終端機：

```
npm install method-override
```

1. server.js
```
import express from "express";
import path from "path";
import mongoose from "mongoose";
import Blog from './models/Blog.js'
import methodOverride from 'method-override';  //增加

const app = express();

app.use(express.json());
app.use(express.urlencoded({ extended: false }))

// set view engine
app.set('view engine' , 'ejs');
app.use(express.static(path.resolve('./public')));
app.use(methodOverride('_method')); //增加



....


app.delete('/DelBlog/:id',async(req,res)=>{
    try {
        await Blog.findByIdAndDelete(req.params.id)
       // res.status(200).json('del !!')
       res.redirect('/Blog') //增加
    } catch (error) {
        res.status(404).json(error)
    }
})

...

```
2. blog.ejs
```
...
    <div class="container">
        <h1 class="mb-4">Blog </h1>
        <a href="/addblog" class="btn btn-success">New Blog</a>
    
        <% Posts.forEach(post => { %>
          <div class="card mt-4">
            <div class="card-body">
              <h4 class="card-title"><%= post.title %></h4>
             
              <div class="card-text mb-2"><%=  post.description %></div>
              <a href="" class="btn btn-primary">Read More</a>
              <a href="" class="btn btn-info">Edit</a>
              <form action="/DelBlog/<%= post.id %>?_method=DELETE" method="POST" class="d-inline"> //加了 
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
          <% }) %>
      </div>
    <%- include('partials/foot.ejs') %>
</body>

</html>
```

---


## 指南（二十二）- 2323
要做的事：
- 建立單獨post頁面  
- 建立單獨post api  

### 建立單獨post頁面  
在views 開Ablog.ejs 

1. views/Ablog.ejs  
```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Blog</title>

  <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
  <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
  <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <%- include('partials/nav.ejs') %>
    <header class="masthead" style="background-image:url('/assets/img/post-bg.jpg?h=9b3eae5bf913af77d61c0390cba13bf5');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="post-heading">

                    </div>
                </div>
            </div>
        </div>
    </header>
  <div class="container">
    <h1 class="mb-1"><%= Ablog.title %></h1>
    <div class="text-muted mb-2">
      <%= Ablog.createdAt.toLocaleDateString() %>
    </div>
    <a href="/Blog" class="btn btn-secondary">All Post</a>
    <a href="" class="btn btn-info">Edit</a>


  </div>

  <%- include('partials/foot.ejs') %>
</body>
</html>
```


----


### 建立單獨post api  

1. ./server.js
```
...

app.get('/Blog',async(req,res)=>{
    // try {
    // const getBlogs = await Blog.find();
    // res.status(200).json(getBlogs) 
    // } catch (error) {
    // res.status(404).json(error)
    // }
    const getposts = await Blog.find();

    res.render('blog' , {Posts: getposts})

})

//增加 以下
app.get('/Blog/:id', async (req,res)=>{
    const getonepost = await Blog.findById(req.params.id)
    res.render('Ablog',{Ablog:getonepost})
})

// 增加 以上

app.get('/AddBlog',(req,res)=>{
    res.render('addblog')
})

...


```


2. views/blog.ejs  

```
...

    <div class="container">
        <h1 class="mb-4">Blog </h1>
        <a href="/addblog" class="btn btn-success">New Blog</a>
    
        <% Posts.forEach(post => { %>
          <div class="card mt-4">
            <div class="card-body">
              <h4 class="card-title"><%= post.title %></h4>
             
              <div class="card-text mb-2"><%=  post.description %></div>
              <a href="/Blog/<%= post.id  %>" class="btn btn-primary">Read More</a>   //加了
              <a href="" class="btn btn-info">Edit</a>
              <form action="/DelBlog/<%= post.id %>?_method=DELETE" method="POST" class="d-inline">
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
          <% }) %>
      </div>

...

```

---

## 指南（二十三）- 2450  
要做的事:

- 連接edit form 頁面  
- 令edit form 運作  

###  連接edit form 頁面

1. ./ server.js

```
....
app.get('/EditBlog/:id',async(req,res)=>{
const getonepost = await Blog.findById(req.params.id) //加了
    res.render('editblog',{Ablog:getonepost})  //加了
})

....

app.put('/EditBlog/:id', async (req,res)=>{
    try {
    const getonepost = await Blog.findById(req.params.id);  //加了
    const updatedblog = await Blog.findByIdAndUpdate(req.params.id,{
        $set:req.body,
    },{new:true})

    //res.status(200).json(updatedblog)
    res.redirect(`/Blog/${getonepost._id}`)  //加了


    } catch (error) {
        res.status(404).json(error)
    }

})

....
```
在partials開 edit_form.ejs
2. views/partials/edit_form.ejs
```
<div class="mb-3"><input class="form-control" type="text" id="name-2" name="title" placeholder="Title" value="<%= Ablog.title %>" ></div>
<div class="mb-3"></div>
<div class="mb-3"><textarea class="form-control" id="message-2" name="description" rows="6" placeholder="Description"><%= Ablog.description %></textarea></div>
<div><button class="btn btn-primary d-block w-100" type="submit">Send </button></div>

```

3. views/Ablog.ejs
```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Blog</title>

  <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css?h=f9f7d0157de2a90e383c7d0678aa83cf">
  <link rel="stylesheet" href="/assets/css/Lora.css?h=4d50cd90998eb6786f5c7cdd6ada1e56">
  <link rel="stylesheet" href="/assets/css/Open%20Sans.css?h=9a60f73863cdefa128874a76ba99deb9">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <%- include('partials/nav.ejs') %>
    <header class="masthead" style="background-image:url('/assets/img/post-bg.jpg?h=9b3eae5bf913af77d61c0390cba13bf5');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="post-heading">

                    </div>
                </div>
            </div>
        </div>
    </header>
  <div class="container">
    <h1 class="mb-1"><%= Ablog.title %></h1>

    <p>
      <%= Ablog.description %>

    </p>
    <div class="text-muted mb-2">
      <%= Ablog.createdAt.toLocaleDateString() %>
    </div>
    <a href="/Blog" class="btn btn-secondary">All Post</a>
    <a href="/EditBlog/<%= Ablog.id  %>" class="btn btn-info">Edit</a> //加了


  </div>

  <%- include('partials/foot.ejs') %>
</body>
</html>


```

4. views/blog.ejs  
```
...
        <% Posts.forEach(post => { %>
          <div class="card mt-4">
            <div class="card-body">
              <h4 class="card-title"><%= post.title %></h4>
             
              <div class="card-text mb-2"><%=  post.description %></div>
              <a href="/Blog/<%= post.id  %>" class="btn btn-primary">Read More</a>
              <a href="/EditBlog/<%= post.id  %>" class="btn btn-info">Edit</a>  //增加
              <form action="/DelBlog/<%= post.id %>?_method=DELETE" method="POST" class="d-inline">
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
          <% }) %>
      </div>
    <%- include('partials/foot.ejs') %>

...

```
---


### 令edit form 運作 

1. views/editblog.ejs
```
...

        <%- include('partials/nav.ejs')  %>
</section>
    
        
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post"  action="/EditBlog/<%= Ablog.id %>?_method=PUT"> //加了 action
                                <%- include('partials/edit_form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>
</body>


```

---
## 指南（二十四）- 2610  
要做的事：
- post register api and post login api 
- 在login 頁面 和 register 頁面 輸入 資料

### post register api and post login api

1. ./server.js
```

....
app.get('/register',(req,res)=>{
    res.render('register')
})


//增加了post 
app.post('/register',(req,res)=>{
    const { email , password } = req.body;

    console.log(req.body)
})


app.get('/login', (req,res)=>{
    res.render('login')
})

//增加了post
app.post('/login',(req,res)=>{
    const {email , password} = req.body;
    console.log(req.body)

})


...

```

---

###  在login 頁面 和 register 頁面 輸入 資料

1. views/login.ejs  
```
...

                            <form class="text-center" method="post" action="/login" >  //增加了 action
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">Login</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs') %>
    ...

```

2. views/register.ejs  
```

....
                            <form class="text-center" method="post"  action="/register"> //加了action
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">register</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs') %>

...

```

---

## 指南（二十五）- 2698  

要做的事：
- 建立 User Schema

-----

### 建立 User Schema  

在models文件夾內創建User.js

1. models/User.js
```
import mongoose from "mongoose";

const UserSchame = new mongoose.Schema({

    email:{
        type: String,
    },
    password:{
        type: String,
    },
},{timestamps:true})

const User = mongoose.models.User || mongoose.model("Users", UserSchame);

export default User
```

---

## 指南（二十六）- 2732

要做的事： 
- 加入 register function  
- 加入 login function  

### 加入 register function  
1. ./server.js  
```
...

app.post('/register', async(req,res)=>{
    const { email , password } = req.body;

    console.log(req.body)

try {
    const newUser = new  User(req.body)

    const saveUser = await newUser.save()

    res.status(200).json(saveUser);

} catch (error) {
    res.status(404).json(error)
}

})


...
```

### 加入 login function 

```
...

app.post('/login',async(req,res)=>{
    const {email , password} = req.body;
    console.log(req.body)
try {
    const user = await User.findOne({email :req.body.email})
    !user && res.status(404).json("email not found!!");

    const ipw = await User.findOne({password : req.body.password})
    !ipw && res.status(404).json("wrong password")

    res.status(200).json("hi!! ",user)

    
} catch (error) {
    res.status(404).json(error)
}



})

...

```

---

## 指南（二十七）- 2798  

要做的事： 
- 安裝 jwt  
- pw 加密  
- 加入redirect 在 register & login

---

1. 在終端:
```
npm install jsonwebtoken bcrypt

```

pw 加密
2. ./server.js
```
import bcrypt from 'bcrypt';  //增加

....

app.post('/register', async(req,res)=>{
    const { email , password } = req.body;
    const saltRounds = 10;  //增加
    const salt = bcrypt.genSaltSync(saltRounds); //增加
    const hash = bcrypt.hashSync(password, salt) //增加
    console.log(req.body)

try {
    const newUser = new  User({
        email : email,

        password : hash  //改了

    })

    const saveUser = await newUser.save()

    // res.status(200).json(saveUser);

    res.redirect('/login') //增加

} catch (error) {
    res.status(404).json(error)
}

})
```
---
pw 解密

3. ./server.js
```
app.post('/login',async(req,res)=>{
    const {email , password} = req.body;
    console.log(req.body)
try {
    const user = await User.findOne({email :req.body.email})
    !user && res.status(404).json("email not found!!");

    // const ipw = await User.findOne({password : req.body.password})
    const ipw = await bcrypt.compareSync(req.body.password , user.password) //改了
    !ipw && res.status(404).json("wrong password")

    //res.status(200).json(user.email)
res.redirect('/')  //增加
    
} catch (error) {
    res.status(404).json(error)
}



})

```
---

加入 jwt 

4. ./server.js  
```
import jwt from 'jsonwebtoken'; //增加

...

app.post('/login',async(req,res)=>{
    const {email , password} = req.body;
    console.log(req.body)
try {
    const user = await User.findOne({email :req.body.email})
    !user && res.status(404).json("email not found!!");

    // const ipw = await User.findOne({password : req.body.password})
    const ipw = await bcrypt.compareSync(req.body.password , user.password)
    !ipw && res.status(404).json("wrong password")

    // res.status(200).json(user.email)

    const token = jwt.sign({id: user._id},"1234") //增加
    const {password , ...others} = user._doc;  //增加

    res.cookie("access_token",token,{httpOnly: true})  //增加


    res.redirect('/') //改了
    
} catch (error) {
    res.status(404).json(error)
}



})


```

---

## 指南（二十八）- 2920  
要做的事：  
- 在nav bar 出現loguot

### 在nav bar 出現loguot  

在終端
```
npm install cookie-parser
```

1. ./server.js  

```
...
import cookieParser from 'cookie-parser';  //增加
...

app.use(express.json());
app.use(cookieParser());  //增加
app.use(express.urlencoded({ extended: false }))
...


 app.get('*', async (req,res,next)=>{
    res.locals.user = req.cookies.access_token

    next()
 })

 ....

app.post('/login',async(req,res)=>{
    const {email , password} = req.body;
    console.log(req.body)
try {
    const user = await User.findOne({email :req.body.email})
    !user && res.status(404).json("email not found!!");

    // const ipw = await User.findOne({password : req.body.password})
    const ipw = bcrypt.compareSync(req.body.password , user.password)
    !ipw && res.status(404).json("wrong password")

    // res.status(200).json(user.email)

    const token = jwt.sign({id: user._id},"1234")
    const {password , ...others} = user._doc;

    res.cookie("access_token",token,{httpOnly: true})

    console.log(`cookies:${req.cookies.access_token}`) //增加
    res.redirect('/')
    
} catch (error) {
    res.status(404).json(error)
}



})


```

2. views/partals/nav.ejs 

```
....


                <% if(user) {  %>

            <li class="nav-item" ><a class="nav-link" href="/logout"> ( logout )</a></li>
              <%  }  else {  %>

            <li class="nav-item"><a class="nav-link" href="/register">register</a></li>
            <li class="nav-item"><a class="nav-link" href="/login">login</a></li>

            <%  } %>


               
            </ul>
        </div>
    </div>
</nav>


```

----

## 指南（二十九）- 3013  
要做的事:  
- 做logout function && api


---

1. ./server.js  

```
app.get('/logout',(req,res)=>{
    res.clearCookie('access_token')
    res.redirect('/')
})


```

---

## 指南（三十）第一部完結 - 3035 
要做的事：
- MVC  
- 破碎後，增加404


---
在目錄裹，新創文件夾 分別 config ， controllers , Routes  
config 裹 開db.js  
controllers 裹 開Blog.js & User.js
Routes 裹 開 Blog.js User.js  

1.  ./server.js
```
import express from "express";
import path from "path";
import methodOverride from 'method-override';
import cookieParser from 'cookie-parser';
import connect from './config/db.js';
const app = express();

app.use(express.json());
app.use(cookieParser());
app.use(express.urlencoded({ extended: false }))

// set view engine
app.set('view engine' , 'ejs');
app.use(express.static(path.resolve('./public')));
app.use(methodOverride('_method'));


 app.get('*', async (req,res,next)=>{
    res.locals.user = req.cookies.access_token

    next()
 })

// router
app.get('/',(req,res)=>{
    res.render('home')
})

app.get('/about',(req,res)=>{
    res.render('about')
})

import BlogRoutes from './Routes/Blog.js'; 
import UserRoutes from './Routes/User.js';

app.use('/blog',BlogRoutes);
app.use('/user',UserRoutes)

app.listen(3000,()=>{
    connect();
    console.log('3000')
})

```

2. config/db.js  
```
// connect mongoose
import mongoose from "mongoose"; 

const  connect = async () =>{
    try {
        await mongoose.connect('mongodb://localhost/blog')
        console.log(' db is connect ')
    } catch (error) {
        console.log (error)
    }

}

export default connect
```
3. controllers/Blog.js  
```
import Blog from '../models/Blog.js';


export const  GetBlogs = async (req,res) =>{
    const getposts = await Blog.find();

    res.render('blog' , {Posts: getposts})
}

export const GetBlogId = async (req,res)=>{
    const getonepost = await Blog.findById(req.params.id)
    res.render('Ablog',{Ablog:getonepost})
}

export const AddBlog = (req,res) =>{
    res.render('addblog')
}

export const EditBlogId = async (req,res) =>{
    const getonepost = await Blog.findById(req.params.id)
    res.render('editblog',{Ablog:getonepost})
}

export const PostBlogPostAdd = async (req,res) =>{
    const {title, description }= req.body;

    console.log('title : ',title , " description : ", description)

    const newBlog = new Blog ({    // res.render('addblog')

        title : title,
        description : description
    })
    
    console.log(newBlog)

     try {
        const saveBlog = await newBlog.save()

   // res.status(200).json(saveBlog)  
    res.redirect('/blog/Blog')
    } catch (error) {
        res.status(404).json(error)
    }
   
}

export const PutEditBlogId = async (req,res)=>{
    try {
        const getonepost = await Blog.findById(req.params.id);
        const updatedblog = await Blog.findByIdAndUpdate(req.params.id,{
            $set:req.body,
        },{new:true})
    
        //res.status(200).json(updatedblog)
        res.redirect(`/blog/Blog/${getonepost._id}`)
    
    
        } catch (error) {
            res.status(404).json(error)
        }
    
}

export const DeleteDelBlogId = async (req,res)=>{
    try {
        await Blog.findByIdAndDelete(req.params.id)
       // res.status(200).json('del !!')
       res.redirect('/blog/Blog')
    } catch (error) {
        res.status(404).json(error)
    }
}
```

4. controllers/User.js
```
import User from "../models/User.js";
import bcrypt from 'bcrypt';
import jwt from 'jsonwebtoken';


export const  GetRegister = (req,res)=>{
    res.render('register')
}

export const GetLogin = (req,res)=>{
    res.render('login')
}

export const GetLogout = (req,res) =>{
    res.clearCookie('access_token')
    res.redirect('/')
}

export const PostRegister = async (req,res) =>{
    const { email , password } = req.body;
    const saltRounds = 10;
    const salt = bcrypt.genSaltSync(saltRounds);
    const hash = bcrypt.hashSync(password, salt)
    console.log(req.body)

try {
    const newUser = new  User({
        email : email,

        password : hash

    })

    const saveUser = await newUser.save()

    // res.status(200).json(saveUser);

    res.redirect('/user/login')

} catch (error) {
    res.status(404).json(error)
}
}

export const PostLogin = async (req,res) =>{
    const {email , password} = req.body;
    console.log(req.body)
try {
    const user = await User.findOne({email :req.body.email})
    !user && res.status(404).json("email not found!!");

    // const ipw = await User.findOne({password : req.body.password})
    const ipw = bcrypt.compareSync(req.body.password , user.password)
    !ipw && res.status(404).json("wrong password")

    // res.status(200).json(user.email)

    const token = jwt.sign({id: user._id},"1234")
    const {password , ...others} = user._doc;

    res.cookie("access_token",token,{httpOnly: true})

    console.log(`cookies:${req.cookies.access_token}`)
    res.redirect('/')
    
} catch (error) {
    res.status(404).json(error)
}

}
```
5. Routes/Blog.js  
```
import express from 'express';
const Router = express.Router();
// import Blog from './models/Blog.js'
import {
    GetBlogs,
    GetBlogId,
    AddBlog,
    PostBlogPostAdd,
    PutEditBlogId,
    DeleteDelBlogId,
    EditBlogId
} from '../controllers/Blog.js'



Router.get('/Blog',GetBlogs)
Router.get('/Blog/:id',GetBlogId)
Router.get('/AddBlog',AddBlog)
Router.get('/EditBlog/:id',EditBlogId)
Router.post('/BlogPostAdd',PostBlogPostAdd)
Router.put('/EditBlog/:id',PutEditBlogId)
Router.delete('/DelBlog/:id',DeleteDelBlogId)



export default Router
```
6. Routes/User.js  
```
import express from 'express';
const Router = express.Router();
import {
    GetLogin,
    GetLogout,
    GetRegister,
    PostLogin,
    PostRegister

} from "../controllers/User.js"

Router.get('/register',GetRegister)

Router.post('/register', PostRegister)

Router.get('/login',GetLogin)

Router.post('/login',PostLogin)

Router.get('/logout',(GetLogout))



export default Router
```
更改api

7. views/partials/nav.ejs

```
...
                <li class="nav-item"><a class="nav-link" href="/" style="margin-left: 11px;margin-right: 14px;">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/about">About us</a></li>
                <li class="nav-item"><a class="nav-link" href="/blog/blog">Blog Post</a></li>


                <% if(user) {  %>

            <li class="nav-item" ><a class="nav-link" href="/user/logout"> ( logout )</a></li>
              <%  }  else {  %>

            <li class="nav-item"><a class="nav-link" href="/user/register">register</a></li>
            <li class="nav-item"><a class="nav-link" href="/user/login">login</a></li>

            <%  } %>

...
```
8. views/Ablog.ejs
```
...

  <div class="container">
    <h1 class="mb-1"><%= Ablog.title %></h1>

    <p>
      <%= Ablog.description %>

    </p>
    <div class="text-muted mb-2">
      <%= Ablog.createdAt.toLocaleDateString() %>
    </div>
    <a href="/blog/Blog" class="btn btn-secondary">All Post</a>
    <a href="/blog/EditBlog/<%= Ablog.id  %>" class="btn btn-info">Edit</a>


  </div>

  <%- include('partials/foot.ejs') %>
</body>
</html>
```

9. views/addblog.ejs
```
...
    <%- include('partials/nav.ejs') %>
    </section>
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post" action="/blog/BlogPostAdd"  >
                                <%- include('partials/form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>

...
```
10. views/blog.ejs
```
...
    <%- include('partials/nav.ejs') %>
    <header class="masthead" style="background-image:url('/assets/img/post-bg.jpg?h=9b3eae5bf913af77d61c0390cba13bf5');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="post-heading">

                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="container">
        <h1 class="mb-4">Blog </h1>
        <a href="/blog/addblog" class="btn btn-success">New Blog</a>
    
        <% Posts.forEach(post => { %>
          <div class="card mt-4">
            <div class="card-body">
              <h4 class="card-title"><%= post.title %></h4>
             
              <div class="card-text mb-2"><%=  post.description %></div>
              <a href="/blog/Blog/<%= post.id  %>" class="btn btn-primary">Read More</a>
              <a href="/blog/EditBlog/<%= post.id  %>" class="btn btn-info">Edit</a>
              <form action="/blog/DelBlog/<%= post.id %>?_method=DELETE" method="POST" class="d-inline">
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
          <% }) %>
      </div>
    <%- include('partials/foot.ejs') %>

...
```
11. views/editblog.ejs
```
...

        <%- include('partials/nav.ejs')  %>
</section>
    
        
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <h2 class="text-center mb-4"></h2>
                            <form method="post"  action="/blog/EditBlog/<%= Ablog.id %>?_method=PUT">
                                <%- include('partials/edit_form.ejs')  %>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include('partials/foot.ejs')  %>

...

```

12. views/login.ejs
```
...

                            <form class="text-center" method="post" action="/user/login" >
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">Login</button></div>
                            </form>
...
```
13. views/register.ejs
```
...
                            <form class="text-center" method="post"  action="/user/register">
                                <div class="mb-3"><input class="form-control" type="email" name="email" placeholder="Email"></div>
                                <div class="mb-3"><input class="form-control" type="password" name="password" placeholder="Password"></div>
                                <div class="mb-3"><button class="btn btn-primary d-block w-100" type="submit">register</button></div>
                            </form>
...
```

---
### 增加404

在views裹開404.ejs

1. views/404.ejs
```
404
```

2. ./server.js

```
...
 app.get('*',(req,res)=>{
    res.render('404')
 })
 ...
```

---

## 指南（三十一）- 3503  
要做的事:
- 深入運用jwt

### 深入運用jwt

運用jwt來進行授權

1. 在目錄 開一個verifyToken.js

```
import jwt from "jsonwebtoken";

export const verifyToken = (req,res,next) => {
    const token = req.cookies.access_token;
    if(!token) return res.json('not authenticated!')

    jwt.verify(token, "1234", (err, user) => {
        if (err) return next(createError(403, "Token is not valid!"));
        req.user = user;
        next()
      });

}
```

2. Routes/User.js
```
import express from 'express';
const Router = express.Router();
import {
    GetLogin,
    GetLogout,
    GetRegister,
    PostLogin,
    PostRegister,
    GetCurrent

} from "../controllers/User.js";


import  Jwt  from 'jsonwebtoken';

import { verifyToken } from '../verifyToken.js';  //增加


Router.get('/register',GetRegister)

Router.post('/register', PostRegister)

Router.get('/login',GetLogin)

Router.post('/login',PostLogin)

Router.get('/logout',GetLogout)

Router.get('/current',verifyToken,GetCurrent) // 增加



export default Router

```

3. controllers/User.js

```
...


export const PostLogin = async (req,res) =>{
    const {email , password} = req.body;
    // console.log(req.body)
try {
    const user = await User.findOne({email :req.body.email})
    !user && res.status(404).json("email not found!!");

    // const ipw = await User.findOne({password : req.body.password})
    const ipw = bcrypt.compareSync(req.body.password , user.password)
    !ipw && res.status(404).json("wrong password")

    // res.status(200).json(user.email)

    const token = jwt.sign({
        id: user._id , 
        email: user.email
    },"1234")
    const {password , ...others} = user._doc;
    console.log(others)

    res.cookie("access_token ",token,{httpOnly: true})

   // console.log(`cookies:${req.cookies.access_token}`)
    res.redirect('/')
    
} catch (error) {
    res.status(404).json(error)
}

}

export const GetCurrent = (req,res) =>{   //增加
    User.find({}, (err, result) => {        //增加
        res.status(200).json({ data: result });  //增加
      });           //增加
}           //增加

```

---